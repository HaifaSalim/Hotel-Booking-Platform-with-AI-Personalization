<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel Details</title>
    <link rel="stylesheet" href="css/hotels.css">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <link rel="stylesheet" href="css/navigation.css">
    <style>
        :root {
            --primary-color: #050b7c;
            --secondary-color: #f8f9fa;
            --accent-color: #ffc107;
            --text-color: #333;
            --light-gray: #f5f5f5;
            --border-radius: 8px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Roboto', sans-serif;
            color: var(--text-color);
            line-height: 1.6;
        }

        .site-header {
            background-color: #ffffff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .site-logo a {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .site-logo a:hover {
            color: #000557;
        }

        .footer-logo {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            display: inline-block;
        }

        .footer-links h5 {
            font-size: 18px;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .footer-links ul {
            list-style: none;
            padding-left: 0;
        }

        .footer-links li {
            margin-bottom: 10px;
        }

        .footer-links a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .footer-title {
            font-family: 'Playfair Display', serif;
        }

        .footer-links a:hover {
            color: white;
        }

        .copyright {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
        }



        .search-button {
            border-radius: 0 !important;
            height: 48px;
            background-color: #000080;
            border-color: #000080;
            width: 100px;
            font-weight: 500;
        }


        .hotel-header {
            background-color: var(--secondary-color);
            padding: 2rem 0;
            margin-bottom: 2rem;
            border-radius: var(--border-radius);
        }

        .hotel-image-container {
            position: relative;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--box-shadow);
            height: 400px;
        }

        .hotel-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .hotel-image:hover {
            transform: scale(1.02);
        }

        .hotel-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background-color: var(--accent-color);
            color: #000;
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .hotel-info {
            padding: 1.5rem;
        }

        .hotel-title {
            color: var(--primary-color);
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .hotel-meta {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .rating-badge {
            background-color: var(--primary-color);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: bold;
            margin-right: 15px;
            display: inline-flex;
            align-items: center;
        }

        .rating-badge i {
            margin-right: 5px;
            color: var(--accent-color);
        }


        .guest-dropdown button.btn-outline-secondary {
            border-radius: 4px;
            width: 43px;
            height: 30px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        #guestDropdown {
            padding: 15px;
            min-width: 250px;
        }

        .guest-dropdown input.form-control {
            border: none;
            background: transparent;
            width: 30px;
            height: 30px;
            padding: 0;
            font-weight: 500;
        }

        #guestSummary {
            white-space: nowrap;
            margin-right: 8px;

        }


        .guest-dropdown .btn-primary {
            border-radius: 4px;
            height: 40px;
            font-weight: 500;
        }

        .guest-dropdown .d-flex {
            margin-bottom: 10px;
        }

        #guestDropdown {
            width: 100%;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-radius: 4px;
            border: 1px solid #e0e0e0;
        }


        .guest-dropdown span {
            font-size: 14px;
        }


        .guest-dropdown .d-flex.align-items-center {
            gap: 5px;
        }



        .quantity-selector {
            display: flex;
            align-items: center;
        }

        .quantity-selector button {
            width: 30px;
            height: 30px;
            background: #f0f0f0;
            border: 1px solid #ddd;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .quantity-selector input {
            width: 50px;
            min-width: 40px;
            height: 34px;
            font-size: 16px;
            text-align: center;
            border: 1px solid #ddd;
            margin: 0 5px;
            padding: 2px 4px;
            box-sizing: border-box;
        }

        .location-text {
            display: flex;
            align-items: center;
            color: #666;
        }

        .location-text i {
            margin-right: 5px;
        }

        .price-highlight {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin: 1rem 0;
        }

        .amenities-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 1.5rem 0;
        }

        .amenity-badge {
            background-color: white;
            border: 1px solid #ddd;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
        }

        .amenity-badge i {
            margin-right: 5px;
            color: var(--primary-color);
        }


        .rooms-section {
            margin: 3rem 0;
        }

        .room-card {
            border: 1px solid #eee;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            background: white;
            box-shadow: var(--box-shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .room-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .room-card.selected {
            border: 2px solid var(--primary-color);
            background-color: #f0f8ff;
        }

        .room-title {
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .room-features {
            list-style: none;
            padding: 0;
            margin: 1rem 0;
        }

        .room-features li {
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
        }

        .room-features i {
            margin-right: 8px;
            color: var(--primary-color);
        }

        .map-section {
            margin: 3rem 0;
        }

        #hotel-map {
            height: 400px;
            width: 100%;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            z-index: 1;
        }


        .reviews-section {
            margin: 3rem 0;
        }

        .review-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--box-shadow);
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .review-author {
            font-weight: 600;
            color: var(--primary-color);
        }

        .review-rating {
            color: var(--accent-color);
            font-weight: bold;
        }

        .review-date {
            color: #777;
            font-size: 0.9rem;
        }

        .booking-summary {
            position: sticky;
            top: 100px;
            background-color: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--box-shadow);
        }

        .summary-title {
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #eee;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .summary-total {
            font-weight: 600;
            font-size: 1.2rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #eee;
        }

        .btn-book {
            background-color: var(--primary-color);
            color: white;
            width: 100%;
            padding: 12px;
            font-weight: 600;
            margin-top: 1.5rem;
            transition: background-color 0.3s ease;
        }

        .btn-book:hover {
            background-color: #000557;
            color: white;
        }

        @media (max-width: 768px) {
            .hotel-image-container {
                height: 300px;
                margin-bottom: 1.5rem;
            }

            #hotel-map {
                height: 300px;
            }

            .booking-summary {
                margin-top: 2rem;
            }
        }

        .star-rating {
            display: inline-flex;
            align-items: center;
        }

        .star-rating .stars {
            color: var(--accent-color);
            margin-right: 5px;
        }

        .star-rating .stars .empty {
            color: #e4e5e9;
        }

        .star-rating .rating-value {
            font-size: 14px;
            color: #666;
            margin-left: 5px;
        }

        .btn {
            background-color: #050b7c;
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 5px;
            display: inline-block;
        }
    </style>
</head>

<body>
    <header class="site-header js-site-header">
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-6 col-lg-4 site-logo" data-aos="fade">
                    <a href="index.html">InnovateStay</a>
                </div>
                <div class="col-6 col-lg-8 text-end">

                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <div id="search-container" class="my-4"></div>

        <section class="hotel-header">
            <div class="row align-items-center">
                <div class="col-lg-6">
                    <h1 id="hotel-name" class="hotel-title">Loading...</h1>
                    <div class="hotel-meta">
                        <span class="rating-badge" id="hotel-rating">
                            <i class="bi bi-star-fill"></i>
                            <span id="rating-value">4.5</span>
                        </span>
                        <span class="location-text" id="hotel-location">
                            <i class="bi bi-geo-alt"></i>
                            <span>Location loading...</span>
                        </span>
                    </div>
                    <div class="price-highlight" id="hotel-price">AED 0.00</div>
                    <div class="amenities-list" id="hotel-amenities">

                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="hotel-image-container">
                        <img id="hotel-image" src="images/default-hotel.jpg" alt="Hotel Image" class="hotel-image">
                        <span class="hotel-badge">Featured</span>
                    </div>
                </div>
            </div>
        </section>

        <div class="row">
            <div class="col-lg-8">
                <section class="hotel-description">
                    <h2 class="mb-4">About This Hotel</h2>
                    <div id="hotel-description" class="mb-5">
                        <p>Loading hotel description...</p>
                    </div>
                </section>

                <section class="map-section">
                    <h2 class="mb-4">Location</h2>
                    <div id="hotel-map"></div>
                    <div class="text-center mt-3">
                        <a href="#" id="directions-btn" class="btn btn-outline-primary">
                            <i class="bi bi-map"></i> Get Directions
                        </a>
                    </div>
                </section>

                <section class="rooms-section">
                    <h2 class="mb-4">Available Rooms</h2>
                    <div id="rooms-list">
                        <p>Loading available rooms...</p>
                    </div>
                </section>

                <section class="reviews-section">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>Guest Reviews</h2>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#reviewModal">
                            <i class="bi bi-pencil"></i> Write a Review
                        </button>
                    </div>
                    <div id="reviews-list">
                        <div class="alert alert-info">Loading reviews...</div>
                    </div>
                </section>
            </div>

            <div class="col-lg-4">
                <div class="booking-summary">
                    <h3 class="summary-title">Your Booking Summary</h3>
                    <div id="selected-rooms-list">
                        <p class="text-muted">No rooms selected yet</p>
                    </div>
                    <div class="summary-item">
                        <span>Subtotal:</span>
                        <span>AED <span id="subtotal-price">0.00</span></span>
                    </div>
                    <div class="summary-item">
                        <span>VAT (5%):</span>
                        <span>AED <span id="vat-amount">0.00</span></span>
                    </div>
                    <div class="summary-total">
                        <span>Total:</span>
                        <span>AED <span id="total-price">0.00</span></span>
                    </div>
                    <button id="proceed-to-reservation" class="btn btn-book">
                        <i class="bi bi-calendar-check"></i> Book Now
                    </button>
                </div>
            </div>
        </div>
    </div>


    <div class="modal fade" id="reviewModal" tabindex="-1" aria-labelledby="reviewModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="reviewModalLabel">Write a Review</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="review-form">
                        <div class="mb-3">
                            <label for="rating" class="form-label">Rating</label>
                            <select id="rating" class="form-select" required>
                                <option value="" selected disabled>Select rating</option>
                                <option value="5">5 Stars - Excellent</option>
                                <option value="4">4 Stars - Very Good</option>
                                <option value="3">3 Stars - Good</option>
                                <option value="2">2 Stars - Fair</option>
                                <option value="1">1 Star - Poor</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="comment" class="form-label">Your Review</label>
                            <textarea id="comment" class="form-control" rows="5" required
                                placeholder="Share your experience..."></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Submit Review</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="js/common.js"></script>
    <script src="js/chatbot-loader.js"></script>
    <script src="js/auth-nav.js"></script>
    <script src="js/reviews.js"></script>

    <script>

        let selectedRooms = [];
        let totalPrice = 0;
        let hotelData = null;
        let map = null;

        document.addEventListener("DOMContentLoaded", function () {

            fetch("search-form.html")
                .then(response => response.text())
                .then(html => {
                    document.getElementById("search-container").innerHTML = html;

                    const checkin = getQueryParam("checkin") || "";
                    const checkout = getQueryParam("checkout") || "";
                    const adults = getQueryParam("adults") || "1";
                    const children = getQueryParam("children") || "0";
                    const rooms = getQueryParam("rooms") || "1";

                    if (document.getElementById("checkin_date")) {
                        document.getElementById("checkin_date").value = checkin;
                        document.getElementById("checkout_date").value = checkout;
                        document.getElementById("adults").value = adults;
                        document.getElementById("children").value = children;
                        document.getElementById("rooms").value = rooms;
                        updateGuestSummary();
                    }

                    if (document.getElementById("searchForm")) {
                        document.getElementById("searchForm").addEventListener("submit", function (event) {
                            event.preventDefault();


                            const hotelId = getQueryParam("id");

                            const checkin = document.getElementById("checkin_date").value;
                            const checkout = document.getElementById("checkout_date").value;
                            const adults = document.getElementById("adults").value;
                            const children = document.getElementById("children").value;
                            const rooms = document.getElementById("rooms").value;

                            const newUrl = `hotel-details.html?id=${hotelId}&checkin=${checkin}&checkout=${checkout}&adults=${adults}&children=${children}&rooms=${rooms}`;

                            window.location.href = newUrl;
                        });
                    }
                })
                .catch(error => console.error("Error loading search form:", error));


            document.getElementById("proceed-to-reservation").addEventListener("click", proceedToReservation);


            document.getElementById("review-form").addEventListener("submit", function (event) {
                event.preventDefault();
                submitReview();
            });

            fetchHotelDetails();
        });

        async function fetchHotelDetails() {
            const hotelId = getQueryParam("id");

            if (!hotelId) {
                document.getElementById("hotel-details").innerHTML = "<p>Hotel not found.</p>";
                return;
            }

            try {
                const response = await fetch(`https://localhost:8443/api/hotels/${hotelId}`);
                if (!response.ok) {
                    throw new Error("Hotel not found");
                }
                hotelData = await response.json();


                const checkin = getQueryParam("checkin");
                const checkout = getQueryParam("checkout");

                let numberOfNights = 1;
                if (checkin && checkout) {
                    const checkinDate = new Date(checkin);
                    const checkoutDate = new Date(checkout);
                    if (checkinDate && checkoutDate && checkoutDate > checkinDate) {
                        numberOfNights = Math.ceil((checkoutDate - checkinDate) / (1000 * 60 * 60 * 24));
                    }
                }


                const totalPrice = hotelData.pricePerNight * numberOfNights;


                document.getElementById("hotel-name").textContent = hotelData.name;
                document.getElementById("rating-value").textContent = hotelData.numericRating || '4.5';
                document.getElementById("hotel-description").innerHTML = formatHotelDescription(hotelData.description);
                document.getElementById("hotel-location").querySelector("span").textContent = hotelData.location || 'Location not specified';
                document.getElementById("hotel-price").textContent = `AED ${totalPrice.toFixed(2)} for ${numberOfNights} night${numberOfNights > 1 ? 's' : ''}`;


                if (hotelData.imageUrl) {
                    document.getElementById("hotel-image").src = hotelData.imageUrl;
                }

                if (hotelData.latitude && hotelData.longitude) {
                    initLeafletMap(hotelData.latitude, hotelData.longitude, hotelData.name);
                } else {
                    document.getElementById("hotel-map").innerHTML =
                        "<div class='alert alert-info'>Map location not available for this hotel.</div>";
                }

                if (hotelData.attractions) {
                    displayAttractions(hotelData.attractions);
                }


                await fetchReviews(hotelId);
                await fetchAvailableRooms(hotelId, checkin, checkout);
            } catch (error) {
                console.error("Error:", error);
                document.getElementById("hotel-name").textContent = "Error loading hotel details";
                document.getElementById("hotel-description").innerHTML =
                    "<div class='alert alert-danger'>Failed to load hotel details. Please try again later.</div>";
            }
        }


        function formatHotelDescription(description) {
            if (!description) return "<p>No description available.</p>";

            const sections = [
                { keyword: 'HeadLine:', tag: 'h4' },
                { keyword: 'Location:', tag: 'h4' },
                { keyword: 'Rooms:', tag: 'h4' },
                { keyword: 'Dining:', tag: 'h4' },
                { keyword: 'CheckIn Instructions:', tag: 'h4' },
                { keyword: 'Special Instructions:', tag: 'h4' }
            ];

            let formattedDescription = description;

            sections.forEach(section => {
                const regex = new RegExp(`(${section.keyword})`, 'gi');
                formattedDescription = formattedDescription.replace(regex, `<${section.tag}>$1</${section.tag}>`);
            });


            formattedDescription = formattedDescription.replace(/\n/g, '</p><p>');


            return `<div class="hotel-description">${formattedDescription}</div>`;
        }

        async function fetchAvailableRooms(hotelId, checkIn, checkOut) {
            try {

                if (!checkIn || !checkOut) {
                    checkIn = getQueryParam("checkin") || "";
                    checkOut = getQueryParam("checkout") || "";
                }

                console.log(`Fetching rooms for dates: ${checkIn} to ${checkOut}`);

                const response = await fetch(`https://localhost:8443/api/rooms/hotel/${hotelId}/rooms?checkIn=${checkIn}&checkOut=${checkOut}`);

                if (!response.ok) {
                    throw new Error("Failed to fetch rooms");
                }

                const rooms = await response.json();
                displayRooms(rooms);
            } catch (error) {
                console.error("Error fetching rooms:", error);
                displayMockRooms();
            }
        }

        function displayAttractions(attractionsHtml) {

            const attractionsSection = document.createElement('section');
            attractionsSection.className = 'my-4';
            attractionsSection.innerHTML = `
                <h2 class="mb-4">Nearby Attractions & Transportation</h2>
                <div class="card">
                    <div class="card-body">
                        ${attractionsHtml}
                    </div>
                </div>
            `;

            const mapSection = document.querySelector('.map-section');
            mapSection.insertAdjacentElement('afterend', attractionsSection);
        }

        function initLeafletMap(lat, lng, hotelName) {
            if (!lat || !lng) return;


            const latitude = parseFloat(lat);
            const longitude = parseFloat(lng);

            map = L.map('hotel-map').setView([latitude, longitude], 15);


            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);


            const hotelIcon = L.icon({
                iconUrl: 'images/hotel-marker.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32],
                popupAnchor: [0, -32]
            });


            L.marker([latitude, longitude], { icon: hotelIcon })
                .addTo(map)
                .bindPopup(`<strong>${hotelName}</strong><br>${hotelData.location}`)
                .openPopup();


            const directionsBtn = document.getElementById('directions-btn');
            directionsBtn.href = `https://www.google.com/maps/dir/?api=1&destination=${latitude},${longitude}`;
            directionsBtn.target = '_blank';
        }

        function displayRooms(rooms) {
            const roomsList = document.getElementById("rooms-list");
            roomsList.innerHTML = "";

            if (rooms.length === 0) {
                roomsList.innerHTML = "<div class='alert alert-info'>No available rooms for the selected dates.</div>";
                return;
            }

            const checkin = getQueryParam("checkin");
            const checkout = getQueryParam("checkout");

            let numberOfNights = 1;
            if (checkin && checkout) {
                const checkinDate = new Date(checkin);
                const checkoutDate = new Date(checkout);
                if (checkinDate && checkoutDate && checkoutDate > checkinDate) {
                    numberOfNights = Math.ceil((checkoutDate - checkinDate) / (1000 * 60 * 60 * 24));
                }
            }

            rooms.forEach(room => {
                const roomDiv = document.createElement("div");
                const totalPrice = room.price * numberOfNights;
                roomDiv.classList.add("room-card");
                roomDiv.dataset.roomId = room.roomId;
                roomDiv.dataset.roomType = room.roomType;
                roomDiv.dataset.price = totalPrice;
                roomDiv.dataset.quantity = room.quantity;


                const amenitiesList = room.amenities.split(',').map(a =>
                    `<li><i class="bi bi-check-circle"></i> ${a.trim()}</li>`
                ).join('');

                roomDiv.innerHTML = `
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h3 class="room-title">${room.roomType}</h3>
                            <p class="text-muted">${room.occupancy} persons</p>
                        </div>
                        <div class="text-end">
                            <div class="price-highlight">AED ${totalPrice.toFixed(2)}</div>
                            <small class="text-muted">for ${numberOfNights} night${numberOfNights > 1 ? 's' : ''}</small>
                        </div>
                    </div>
                    <ul class="room-features">
                        ${amenitiesList}
                    </ul>
                    <div class="d-flex justify-content-between align-items-center mt-3">
                        <div class="text-muted small">${room.quantity} rooms available</div>
                        <div class="quantity-selector">
                            <button class="btn btn-outline-secondary decrease-quantity" onclick="updateRoomQuantity(${room.roomId}, false)">
                                <i class="bi bi-dash"></i>
                            </button>
                            <input type="number" id="quantity-${room.roomId}" class="form-control text-center" 
                                min="0" max="${room.quantity}" value="0" readonly style="width: 50px;">
                            <button class="btn btn-outline-secondary increase-quantity" onclick="updateRoomQuantity(${room.roomId}, true)">
                                <i class="bi bi-plus"></i>
                            </button>
                        </div>
                    </div>
                `;
                roomsList.appendChild(roomDiv);
            });
        }

        async function fetchReviews(hotelId) {
            try {
                const response = await fetch(`https://localhost:8443/api/reviews/hotel/${hotelId}`);
                if (!response.ok) {
                    throw new Error(`Failed to fetch reviews: ${response.statusText}`);
                }
                const reviews = await response.json();
                displayReviews(reviews);
            } catch (error) {
                console.error("Error fetching reviews:", error);
                document.getElementById("reviews-list").innerHTML = `
                    <div class="alert alert-info">Unable to load reviews at this time.</div>
                `;
            }
        }

        function displayReviews(reviews) {
            const reviewsList = document.getElementById("reviews-list");
            reviewsList.innerHTML = "";

            if (reviews.length === 0) {
                reviewsList.innerHTML = `
                    <div class="alert alert-info">
                        No reviews yet. Be the first to leave one!
                    </div>
                `;
                return;
            }

            reviews.forEach(review => {
                const reviewDiv = document.createElement("div");
                reviewDiv.classList.add("review-card");


                const username = review.user ? (review.user.username || "Anonymous") : "Anonymous";
                const stars = '★'.repeat(review.rating) + '☆'.repeat(5 - review.rating);

                reviewDiv.innerHTML = `
                    <div class="review-header">
                        <span class="review-author">${username}</span>
                        <span class="review-rating" title="${review.rating} out of 5 stars">
                            ${stars}
                        </span>
                    </div>
                    <div class="review-content mb-2">
                        <p>${review.comment || "No comment provided."}</p>
                    </div>
                    <div class="review-date">
                        ${new Date(review.reviewDate).toLocaleDateString('en-US', {
                    year: 'numeric', month: 'long', day: 'numeric'
                })}
                    </div>
                `;
                reviewsList.appendChild(reviewDiv);
            });
        }

        async function submitReview() {
            const hotelId = getQueryParam("id");
            const userId = await getUserId();
            const rating = document.getElementById("rating").value;
            const comment = document.getElementById("comment").value;

            if (!hotelId) {
                console.error("Hotel ID is missing!");
                return;
            }

            if (!userId) {
                alert("You must be logged in to submit a review.");
                return;
            }

            const reviewData = {
                hotelId: parseInt(hotelId),
                userId: parseInt(userId),
                rating: parseInt(rating),
                comment: comment
            };

            try {
                const response = await fetch("/api/reviews", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    credentials: "include",
                    body: JSON.stringify(reviewData)
                });

                if (!response.ok) throw new Error("Failed to submit review");


                bootstrap.Modal.getInstance(document.getElementById('reviewModal')).hide();
                alert("Thank you for your review!");
                fetchReviews(hotelId);
                document.getElementById("review-form").reset();
            } catch (error) {
                console.error("Error submitting review:", error);
                alert("An error occurred while submitting the review.");
            }
        }

        function updateRoomQuantity(roomId, increase) {
            const quantityInput = document.getElementById(`quantity-${roomId}`);
            let quantity = parseInt(quantityInput.value);
            const maxQuantity = parseInt(quantityInput.max);

            if (increase && quantity < maxQuantity) {
                quantity++;
            } else if (!increase && quantity > 0) {
                quantity--;
            }

            quantityInput.value = quantity;


            const roomCard = document.querySelector(`.room-card[data-room-id="${roomId}"]`);
            const roomType = roomCard.dataset.roomType;
            const price = parseFloat(roomCard.dataset.price);


            updateSelectedRooms(roomId, roomType, price, quantity);
        }

        function updateSelectedRooms(roomId, roomType, price, quantity) {

            selectedRooms = selectedRooms.filter(room => room.roomId != roomId);


            if (quantity > 0) {
                selectedRooms.push({
                    roomId: roomId,
                    roomType: roomType,
                    price: price,
                    quantity: quantity
                });
            }

            updateSelectedRoomsUI();
        }

        function updateSelectedRoomsUI() {
            const selectedRoomsList = document.getElementById("selected-rooms-list");
            const selectedRoomsContainer = document.getElementById("selected-rooms-container");

            if (selectedRooms.length === 0) {
                selectedRoomsList.innerHTML = "<p class='text-muted'>No rooms selected yet</p>";
                document.getElementById("subtotal-price").textContent = "0.00";
                document.getElementById("vat-amount").textContent = "0.00";
                document.getElementById("total-price").textContent = "0.00";
                return;
            }

            selectedRoomsList.innerHTML = "";
            let subtotal = 0;

            selectedRooms.forEach(room => {
                const roomTotal = room.price * room.quantity;
                subtotal += roomTotal;

                const roomItem = document.createElement("div");
                roomItem.classList.add("summary-item");
                roomItem.innerHTML = `
                    <span>${room.quantity} x ${room.roomType}</span>
                    <span>AED ${roomTotal.toFixed(2)}</span>
                `;
                selectedRoomsList.appendChild(roomItem);
            });

            const vatRate = 0.05;
            const vatAmount = subtotal * vatRate;
            const totalPrice = subtotal + vatAmount;


            document.getElementById("subtotal-price").textContent = subtotal.toFixed(2);
            document.getElementById("vat-amount").textContent = vatAmount.toFixed(2);
            document.getElementById("total-price").textContent = totalPrice.toFixed(2);
        }
        function proceedToReservation() {
            if (selectedRooms.length === 0) {
                alert("Please select at least one room");
                return;
            }

            const checkin = getQueryParam("checkin") || document.getElementById("checkin_date")?.value;
            const checkout = getQueryParam("checkout") || document.getElementById("checkout_date")?.value;
            const adults = getQueryParam("adults") || document.getElementById("adults")?.value;
            const children = getQueryParam("children") || document.getElementById("children")?.value;
            const roomsCount = getQueryParam("rooms") || document.getElementById("rooms")?.value;

            if (!checkin || !checkout) {
                alert("Please select check-in and check-out dates");
                return;
            }

            const hotelId = getQueryParam("id");
            localStorage.setItem("selectedHotelId", hotelId);
            localStorage.setItem("selectedRooms", JSON.stringify(selectedRooms));


            const params = new URLSearchParams({
                checkin: checkin,
                checkout: checkout,
                adults: adults || "1",
                children: children || "0",
                rooms: roomsCount || "1"
            });

            window.location.href = `reservation.html?${params.toString()}`;
        }
    </script>

    <script src="js/auth-nav.js"></script>

    </section>
    <footer style="background-color: #313661;" class="text-white py-5">
        <div class="container">
            <div class="row justify-content-between text-center text-md-start">
                <div class="col-md-4 mb-4 mb-md-0">
                    <a href="index.html" class="footer-logo text-white h4 d-block mb-2">InnovateStay</a>
                    <p>Your trusted AI-powered hotel booking platform, making travel planning smarter and easier.</p>
                </div>

                <div class="col-md-3 mb-4 mb-md-0">
                    <h5 class="text-white fw-bold footer-title">Support</h5>
                    <ul class="list-unstyled">
                        <li><a href="/cancel-reservation.html" class="text-white text-decoration-none">Cancel
                                Reservation</a></li>
                    </ul>
                </div>

                <div class="col-md-3">
                    <h5 class="text-white fw-bold footer-title">Contact</h5>
                    <ul class="list-unstyled">
                        <li><a href="#" class="text-white text-decoration-none">+971 50 123 4567</a></li>
                        <li><a href="#" class="text-white text-decoration-none">bookings.innnovate@gmail.com</a></li>
                        <li><a href="#" class="text-white text-decoration-none">Abu Dhabi, UAE</a></li>
                    </ul>
                </div>
            </div>

            <div class="text-center pt-4 mt-4 border-top border-light">
                <p class="mb-0">&copy; 2025 InnovateStay. All rights reserved.</p>
            </div>
        </div>
    </footer>
</body>

</html>