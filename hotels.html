<!DOCTYPE HTML>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hotels Listing</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="css/navigation.css">
  <link rel="stylesheet" href="css/hotels.css">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

  <style>
    body {
      font-family: Arial, sans-serif;
    }

    .filters {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 10px;
    }

    .footer-title {
      font-family: 'Playfair Display', serif;
    }


    .hotel-card img {
      width: 100%;
      height: 180px;
      object-fit: cover;
    }

    .hotel-card {
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      transition: 0.3s;
    }

    .hotel-card:hover {
      transform: scale(1.02);
    }

    .view-details-btn {
      width: 100%;
      margin-top: 10px;
    }


    .chat-widget {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 350px;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      display: flex;
      flex-direction: column;
      transition: all 0.3s ease;
      max-height: 500px;
    }

    .site-header {
      background-color: #ffffff;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      padding: 15px 0;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .site-logo a {
      font-size: 24px;
      font-weight: bold;
      color: #050b7c;
      text-decoration: none;
      transition: color 0.3s ease;
    }

    .site-logo a:hover {
      color: #000557;
    }


    @media (max-width: 991px) {
      .site-header .text-end {
        text-align: right !important;
      }
    }




    .btn {
      background: #050b7c;
      color: white;
      border: none;
      padding: 10px;
      cursor: pointer;
      border-radius: 5px;
    }

    .btn:hover {
      background: #050b7c;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }


    .guest-dropdown button.btn-outline-secondary {
      border-radius: 4px;
      width: 40px;
      height: 30px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    .guest-dropdown input.form-control {
      border: none;
      background: transparent;
      width: 30px;
      height: 30px;
      padding: 0;
      font-weight: 500;
    }

    .guest-dropdown .btn-primary {
      border-radius: 4px;
      height: 40px;
      font-weight: 500;
    }

    .guest-dropdown .d-flex {
      margin-bottom: 10px;
    }

    #guestDropdown {
      width: 100%;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      border-radius: 4px;
      border: 1px solid #e0e0e0;
    }

    .guest-dropdown span {
      font-size: 14px;
    }

    .guest-dropdown .d-flex.align-items-center {
      gap: 5px;
    }

    .footer-logo {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 20px;
      display: inline-block;
    }

    .footer-links h5 {
      font-size: 18px;
      margin-bottom: 20px;
      font-weight: 600;
    }

    .footer-links ul {
      list-style: none;
      padding-left: 0;
    }

    .footer-links li {
      margin-bottom: 10px;
    }

    .footer-links a {
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      transition: color 0.3s ease;
    }

    .footer-links a:hover {
      color: white;
    }

    .copyright {
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      text-align: center;
      color: rgba(255, 255, 255, 0.6);
      font-size: 14px;
    }


    .chat-widget.collapsed {
      height: 60px;
      overflow: hidden;
    }

    .chat-header {
      padding: 15px;
      background-color: #000557;
      color: white;
      border-top-left-radius: 10px;
      border-top-right-radius: 10px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .chat-box {
      height: 300px;
      overflow-y: auto;
      padding: 15px;
      background-color: #f9f9f9;
      flex-grow: 1;
    }

    .input-area {
      display: flex;
      padding: 10px;
      border-top: 1px solid #eee;
      background-color: white;
    }

    .input-box {
      flex-grow: 1;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-right: 5px;
    }

    .send-button {
      background-color: #000557;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 4px;
      cursor: pointer;
    }

    .user-message {
      text-align: right;
      background-color: #dcf8c6;
      padding: 8px 12px;
      border-radius: 10px;
      margin: 5px 0;
      max-width: 80%;
      margin-left: auto;
    }

    .bot-message {
      background-color: white;
      padding: 8px 12px;
      border-radius: 10px;
      margin: 5px 0;
      max-width: 80%;
    }

    .toggle-icon {
      transition: transform 0.3s ease;
    }

    .collapsed .toggle-icon {
      transform: rotate(180deg);
    }

    .quantity-selector {
      display: flex;
      align-items: center;
    }

    .quantity-selector button {
      width: 30px;
      height: 30px;
      background: #f0f0f0;
      border: 1px solid #ddd;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    .quantity-selector input {
      width: 40px;
      height: 30px;
      text-align: center;
      border: 1px solid #ddd;
      margin: 0 5px;
    }


    .guest-dropdown button.btn-outline-secondary {
      border-radius: 4px;
      width: 40px;
      height: 30px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    .guest-dropdown input.form-control {
      border: none;
      background: transparent;
      width: 30px;
      height: 30px;
      padding: 0;
      font-weight: 500;
    }

    .guest-dropdown .btn-primary {
      border-radius: 4px;
      height: 40px;
      font-weight: 500;
    }

    .guest-dropdown .d-flex {
      margin-bottom: 10px;
    }

    #guestDropdown {
      width: 100%;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      border-radius: 4px;
      border: 1px solid #e0e0e0;
    }

    .guest-dropdown span {
      font-size: 14px;
    }

    .guest-dropdown .d-flex.align-items-center {
      gap: 5px;
    }

    .site-header {
      background-color: #ffffff;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      padding: 15px 0;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .site-logo a {
      font-size: 24px;
      font-weight: bold;
      color: #000557;
      text-decoration: none;
      transition: color 0.3s ease;
    }

    .site-logo a:hover {
      color: #000557;
    }

    .accordion-collapse {
      overflow: visible;
    }


    @media (max-width: 991px) {
      .site-header .text-end {
        text-align: right !important;
      }
    }
  </style>
</head>

<body>

  <header class="site-header js-site-header">
    <div class="container-fluid">
      <div class="row align-items-center">
        <div class="col-6 col-lg-4 site-logo" data-aos="fade"><a href="index.html">InnovateStay</a></div>
        <div class="col-6 col-lg-8 text-end">
          <div class="col-6 col-lg-8 text-end">

          </div>


        </div>
      </div>
    </div>
  </header>
  <section class="section bg-light pb-3">
    <div id="search-container"></div>
  </section>


  <section class="section bg-light">
    <div class="container">
      <div class="row">
        <aside class="col-md-3">
          <div class="filters p-3 bg-white rounded shadow-sm">
            <h4 class="mb-3">Find Your Perfect Stay</h4>
            <form id="filterForm">
              <div class="accordion" id="filterAccordion">

                <div class="accordion-item mb-2">
                  <h2 class="accordion-header">
                    <button class="accordion-button py-2" type="button" data-bs-toggle="collapse"
                      data-bs-target="#priceCollapse">
                      Price Range
                    </button>
                  </h2>
                  <div id="priceCollapse" class="accordion-collapse collapse show">
                    <div class="accordion-body">
                      <div id="priceValue" class="mb-2">AED 100 - 3000</div>
                      <div class="row">
                        <div class="col">
                          <label for="price-min" class="form-label small">Min</label>
                          <input type="range" class="form-range" min="100" max="3000" step="50" id="price-min"
                            value="100">
                        </div>
                        <div class="col">
                          <label for="price-max" class="form-label small">Max</label>
                          <input type="range" class="form-range" min="100" max="3000" step="50" id="price-max"
                            value="3000">
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="accordion-item mb-2">
                  <h2 class="accordion-header">
                    <button class="accordion-button py-2" type="button" data-bs-toggle="collapse"
                      data-bs-target="#nameSearchCollapse">
                      Search by Name
                    </button>
                  </h2>
                  <div id="nameSearchCollapse" class="accordion-collapse collapse show">
                    <div class="accordion-body">
                      <div class="input-group">
                        <input type="text" id="hotel-name-search" class="form-control" placeholder="Hotel name..."
                          aria-label="Search hotels">
                        <button class="btn btn-outline-secondary" type="button" id="clearNameSearch">
                          <i class="bi bi-x"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>


                <div class="accordion-item mb-2">
                  <h2 class="accordion-header">
                    <button class="accordion-button collapsed py-2" type="button" data-bs-toggle="collapse"
                      data-bs-target="#typeCollapse">
                      Hotel Type
                    </button>
                  </h2>
                  <div id="typeCollapse" class="accordion-collapse collapse">
                    <div class="accordion-body">
                      <div class="d-flex flex-wrap gap-2">
                        <div class="form-check"><input class="form-check-input type-filter" type="checkbox"
                            value="hotel" id="hotel"><label class="form-check-label" for="hotel">Hotel</label></div>
                        <div class="form-check"><input class="form-check-input type-filter" type="checkbox"
                            value="resort" id="resort"><label class="form-check-label" for="resort">Resort</label></div>
                        <div class="form-check"><input class="form-check-input type-filter" type="checkbox"
                            value="apartment" id="apartment"><label class="form-check-label"
                            for="apartment">Apartment</label></div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="accordion-item mb-2">
                  <h2 class="accordion-header">
                    <button class="accordion-button collapsed py-2" type="button" data-bs-toggle="collapse"
                      data-bs-target="#ratingCollapse">
                      Rating
                    </button>
                  </h2>
                  <div id="ratingCollapse" class="accordion-collapse collapse">
                    <div class="accordion-body">
                      <div class="d-flex flex-wrap gap-2">
                        <div class="form-check"><input class="form-check-input" type="checkbox" value="5"
                            id="rating5"><label class="form-check-label" for="rating5">⭐⭐⭐⭐⭐</label></div>
                        <div class="form-check"><input class="form-check-input" type="checkbox" value="4"
                            id="rating4"><label class="form-check-label" for="rating4">⭐⭐⭐⭐</label></div>
                        <div class="form-check"><input class="form-check-input" type="checkbox" value="3"
                            id="rating3"><label class="form-check-label" for="rating3">⭐⭐⭐</label></div>
                        <div class="form-check"><input class="form-check-input" type="checkbox" value="2"
                            id="rating2"><label class="form-check-label" for="rating2">⭐⭐</label></div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="accordion-item mb-2">
                  <h2 class="accordion-header">
                    <button class="accordion-button collapsed py-2" type="button" data-bs-toggle="collapse"
                      data-bs-target="#amenitiesCollapse">
                      Amenities
                    </button>
                  </h2>
                  <div id="amenitiesCollapse" class="accordion-collapse collapse">
                    <div class="accordion-body">
                      <div class="d-flex flex-wrap gap-2">
                        <div class="form-check"><input class="form-check-input amenity-filter" type="checkbox"
                            value="wifi" id="wifi"><label class="form-check-label" for="wifi">WiFi</label></div>
                        <div class="form-check"><input class="form-check-input amenity-filter" type="checkbox"
                            value="beach" id="beach"><label class="form-check-label" for="beach">Beach</label></div>
                        <div class="form-check"><input class="form-check-input amenity-filter" type="checkbox"
                            value="breakfast" id="breakfast"><label class="form-check-label" for="breakfast">Free
                            Breakfast</label></div>
                        <div class="form-check"><input class="form-check-input amenity-filter" type="checkbox"
                            value="parking" id="parking"><label class="form-check-label" for="parking">Free
                            Parking</label></div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="accordion-item mb-2">
                  <h2 class="accordion-header">
                    <button class="accordion-button collapsed py-2" type="button" data-bs-toggle="collapse"
                      data-bs-target="#sortCollapse">
                      Sort By
                    </button>
                  </h2>
                  <div id="sortCollapse" class="accordion-collapse collapse">
                    <div class="accordion-body">
                      <select id="sortBy" class="form-select">
                        <option value="price_asc">Price: Low to High</option>
                        <option value="price_desc">Price: High to Low</option>
                        <option value="rating_desc">Rating: High to Low</option>
                        <option value="rating_asc">Rating: Low to High</option>
                      </select>
                    </div>
                  </div>
                </div>

              </div>


              <div class="d-flex gap-2 mt-3">
                <button type="button" id="clearFilters" class="btn btn-outline-secondary flex-grow-1">Clear All</button>
                <button type="submit" class="btn btn-primary flex-grow-1">Apply Filters</button>
              </div>
            </form>
          </div>
        </aside>


        <div class="col-md-9">
          <h2>Available Hotels</h2>
          <div class="row" id="hotelContainer"></div>
        </div>
      </div>
    </div>
  </section>

  <div class="chat-widget" id="chatWidget">
    <div class="chat-header" id="chatHeader">
      <h5 style="margin: 0">Hotel Booking Chatbot</h5>
      <span class="toggle-icon">▼</span>
    </div>
    <div id="chatBox" class="chat-box">

      <p class="bot-message"><strong>Bot:</strong> Hi there! I can help you find the perfect hotel. Ask me
        anything about our properties, amenities, or booking process.</p>
    </div>
    <div class="input-area">
      <input type="text" id="userMessage" class="input-box" placeholder="Ask about hotels..." />
      <button id="sendButton" class="send-button">Send</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script src="js/common.js"></script>
  <script src="js/hotel-filters.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      console.log("Page loaded, initializing hotel search...");

      fetch("search-form.html")
        .then(response => response.text())
        .then(html => {
          document.getElementById("search-container").innerHTML = html;


          const checkin = getQueryParam("checkin") || "";
          const checkout = getQueryParam("checkout") || "";
          const location = getQueryParam("location") || "";
          const adults = getQueryParam("adults") || "1";
          const children = getQueryParam("children") || "0";
          const rooms = getQueryParam("rooms") || "1";

          if (document.getElementById("checkin_date")) {
            document.getElementById("checkin_date").value = checkin;
            document.getElementById("checkout_date").value = checkout;
            document.getElementById("location").value = location;
            document.getElementById("adults").value = adults;
            document.getElementById("children").value = children;
            document.getElementById("rooms").value = rooms;
            updateGuestSummary();
          }
        })
        .catch(error => console.error("Error loading search form:", error));




      fetchHotels();


      initChatWidget();
    });

    async function getUserId() {
      try {
        const response = await fetch("/users/profile", {
          method: "GET",
          credentials: "include"
        });

        if (!response.ok) {
          throw new Error("User not logged in");
        }

        const user = await response.json();
        return user.id;
      } catch (error) {
        console.error("Error fetching user ID:", error);
        return null;
      }
    }
    async function fetchHotels() {
      try {
        const response = await fetch("https://localhost:8443/api/hotels");
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

        let hotels = await response.json();

        const location = getQueryParam("location");


        if (location && location.trim() !== '') {
          const locationTerm = location.trim().toLowerCase();
          hotels = hotels.filter(hotel =>
            hotel.cityName && hotel.cityName.toLowerCase().includes(locationTerm)
          );

          console.log(`Filtered to ${hotels.length} hotels matching cityName "${locationTerm}"`);
        }


        const checkin = getQueryParam("checkin");
        const checkout = getQueryParam("checkout");


        let numberOfNights = 1;
        if (checkin && checkout) {
          const checkinDate = new Date(checkin);
          const checkoutDate = new Date(checkout);
          if (checkinDate && checkoutDate && checkoutDate > checkinDate) {
            numberOfNights = Math.ceil((checkoutDate - checkinDate) / (1000 * 60 * 60 * 24));
          }
        }


        hotels = hotels.map(hotel => {
          const totalPrice = hotel.pricePerNight * numberOfNights;

          return {
            ...hotel,
            totalPrice: totalPrice,
            numberOfNights: numberOfNights
          };
        });

        displayHotels(hotels);
      } catch (error) {
        console.error("Failed to fetch hotels:", error);
      }
    }
    function generateStars(numericRating) {
      let stars = '';
      for (let i = 0; i < 5; i++) {
        stars += i < numericRating
          ? '<i class="bi bi-star-fill text-warning"></i>'
          : '<i class="bi bi-star text-warning"></i>';
      }
      return stars;
    }

    function displayHotels(hotels) {
      const hotelContainer = document.getElementById("hotelContainer");

      if (!hotelContainer) {
        console.error("Hotel container element not found!");
        return;
      }

      hotelContainer.innerHTML = "";

      if (hotels.length === 0) {
        hotelContainer.innerHTML = "<p>No hotels found matching your criteria.</p>";
        return;
      }

      hotels.forEach((hotel) => {

        const numericRating = hotel.numericRating || 0;

        const reviewDisplay = (hotel.reviewCount && hotel.reviewCount > 0)
          ? `<span class="text-muted small">(${hotel.reviewCount} review${hotel.reviewCount !== 1 ? 's' : ''})</span>`
          : '';


        const stars = generateStars(numericRating);
        const hotelCard = `
          <div class="col-md-4 mb-4" data-rating="${numericRating}">
                <div class="card hotel-card">
                    <img src="${hotel.imageUrl || 'images/default_hotel.jpg'}" class="card-img-top" alt="Hotel Image">
                    <div class="card-body">
                        <h5 class="card-title">${hotel.name}</h5>
                        <div class="mb-2">
                        ${stars} 
                        ${reviewDisplay}
                    </div>
                        <p><strong>Price:</strong> AED ${hotel.totalPrice.toFixed(2)} for ${hotel.numberOfNights} night${hotel.numberOfNights > 1 ? 's' : ''}</p>
                        <p><strong>Location:</strong> ${hotel.location || 'Various locations'}</p>
                        <a href="hotel-details.html?id=${hotel.hotelId}&checkin=${getQueryParam("checkin") || ''}&checkout=${getQueryParam("checkout") || ''}&adults=${getQueryParam("adults") || '1'}&children=${getQueryParam("children") || '0'}&rooms=${getQueryParam("rooms") || '1'}" class="btn btn-primary">View Details</a>
                    </div>
                </div>
            </div>`;
        hotelContainer.innerHTML += hotelCard;
      });

      applyFilters();
    }
    function initChatWidget() {
      const chatHeader = document.getElementById('chatHeader');
      const chatWidget = document.getElementById('chatWidget');
      const sendButton = document.getElementById('sendButton');
      const userMessageInput = document.getElementById('userMessage');
      const chatBox = document.getElementById('chatBox');

      chatHeader.addEventListener('click', function () {
        chatWidget.classList.toggle('collapsed');
      });

      sendButton.addEventListener('click', sendMessage);

      userMessageInput.addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
          sendMessage();
        }
      });

      async function sendMessage() {
        const userMessage = userMessageInput.value.trim();
        if (!userMessage) return;

        const userMessageElement = document.createElement('p');
        userMessageElement.className = 'user-message';
        userMessageElement.innerHTML = `<strong>You:</strong> ${userMessage}`;
        chatBox.appendChild(userMessageElement);

        userMessageInput.value = '';

        const typingIndicator = document.createElement('p');
        typingIndicator.className = 'bot-message';
        typingIndicator.innerHTML = '<strong>Bot:</strong> Typing...';
        chatBox.appendChild(typingIndicator);
        chatBox.scrollTop = chatBox.scrollHeight;

        try {
          let location = null;
          const commonLocations = ['abu dhabi', 'dubai', 'sharjah', 'ajman', 'fujairah'];
          const lowerMessage = userMessage.toLowerCase();

          for (const loc of commonLocations) {
            if (lowerMessage.includes(loc)) {
              location = loc;
              break;
            }
          }

          const userId = await getUserId();

          const payload = {
            input: userMessage,
            user_id: userId,
            new_visitor_info: location ? { location } : null,
            location_specific: !!location
          };


          const response = await fetch('http://localhost:5000/chat', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(payload),
          });

          const data = await response.json();
          const botMessage = data.response;

          chatBox.removeChild(typingIndicator);

          const botMessageElement = document.createElement('p');
          botMessageElement.className = 'bot-message';
          botMessageElement.innerHTML = `<strong>Bot:</strong> ${botMessage}`;
          chatBox.appendChild(botMessageElement);


          chatBox.scrollTop = chatBox.scrollHeight;
        } catch (error) {
          console.error('Error:', error);

          chatBox.removeChild(typingIndicator);

          const errorMessage = document.createElement('p');
          errorMessage.className = 'bot-message';
          errorMessage.innerHTML = '<strong>Bot:</strong> Sorry, I\'m having trouble connecting to the server. Please try again later.';
          chatBox.appendChild(errorMessage);
          chatBox.scrollTop = chatBox.scrollHeight;
        }
      }
    }
  </script>
  </script>
  <script src="js/auth-nav.js"></script>

  </section>
  <footer style="background-color: #313661;" class="text-white py-5">
    <div class="container">
      <div class="row justify-content-between text-center text-md-start">
        <div class="col-md-4 mb-4 mb-md-0">
          <a href="index.html" class="footer-logo text-white h4 d-block mb-2">InnovateStay</a>
          <p>Your trusted AI-powered hotel booking platform, making travel planning smarter and easier.</p>
        </div>

        <div class="col-md-3 mb-4 mb-md-0">
          <h5 class="text-white fw-bold footer-title">Support</h5>


          <ul class="list-unstyled">
            <li><a href="/cancel-reservation.html" class="text-white text-decoration-none">Cancel Reservation</a></li>
          </ul>
        </div>

        <div class="col-md-3">
          <h5 class="text-white fw-bold footer-title">Contact</h5>
          <ul class="list-unstyled">
            <li><a href="#" class="text-white text-decoration-none">+971 50 123 4567</a></li>
            <li><a href="#" class="text-white text-decoration-none">bookings.innnovate@gmail.com</a></li>
            <li><a href="#" class="text-white text-decoration-none">Abu Dhabi, UAE</a></li>
          </ul>
        </div>
      </div>

      <div class="text-center pt-4 mt-4 border-top border-light">
        <p class="mb-0">&copy; 2025 InnovateStay. All rights reserved.</p>
      </div>
    </div>
  </footer>
</body>

</html>